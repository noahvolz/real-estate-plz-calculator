<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>German Real Estate PLZ Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <header class="app-header">
      <h1>German Real Estate Investment Calculator</h1>
      <p class="subtitle">
        Step 1: basic calculator (no charts yet). Enter your values and click "Run calculation".
      </p>
    </header>

    <main class="app-main">
      <!-- LEFT: INPUT FORM -->
      <section class="panel panel-inputs">
        <h2>Inputs</h2>

        <form id="inputForm">
          <!-- Property & purchase -->
          <fieldset>
            <legend>Property & Purchase</legend>

            <label>
              Building value (€)
              <input type="number" id="buildingValue" value="200000" step="1000" />
            </label>

            <label>
              Land value (€)
              <input type="number" id="landValue" value="80000" step="1000" />
            </label>

            <label>
              Grunderwerbsteuer (% of price)
              <input type="number" id="grEStRatePct" value="5" step="0.1" />
            </label>

            <label>
              Agent fee / Makler (% of price)
              <input type="number" id="maklerRatePct" value="3" step="0.1" />
            </label>

            <label>
              Land register / Grundbuch (% of price)
              <input type="number" id="grundbuchRatePct" value="0.5" step="0.1" />
            </label>

            <label>
              Notary (% of price)
              <input type="number" id="notaryRatePct" value="1.5" step="0.1" />
            </label>

            <label>
              Company setup cost (€)
              <input type="number" id="companyCost" value="0" step="1000" />
            </label>

            <label>
              Fitting up / Ausbau (€)
              <input type="number" id="fittingUp" value="30000" step="1000" />
            </label>

            <label>
              Initial repairs (€)
              <input type="number" id="initialRepairs" value="5000" step="1000" />
            </label>
          </fieldset>

          <!-- Value development -->
          <fieldset>
            <legend>Value Development</legend>

            <label>
              Building value loss (% p.a.)
              <input type="number" id="buildingLossRatePct" value="1" step="0.1" />
            </label>

            <label>
              Land value growth (% p.a.)
              <input type="number" id="landGrowthRatePct" value="0.5" step="0.1" />
            </label>

            <label>
              Construction cost inflation (% p.a.)
              <input type="number" id="constructionCostGrowthPct" value="1.5" step="0.1" />
            </label>
          </fieldset>

          <!-- Rent & maintenance -->
          <fieldset>
            <legend>Rent & Maintenance</legend>

            <label>
              Size (m²)
              <input type="number" id="sqm" value="80" step="1" />
            </label>

            <label>
              Monthly rent (base, € cold)
              <input type="number" id="monthlyRent" value="1200" step="50" />
            </label>

            <label>
              Vacancy / Mietausfall (% of year)
              <input type="number" id="vacancyRatePct" value="5" step="0.5" />
            </label>

            <label>
              Rent growth (% p.a.)
              <input type="number" id="rentGrowthPct" value="1" step="0.1" />
            </label>

            <label>
              Annual maintenance & operating (€ in year 1)
              <input type="number" id="annualMaintenance" value="3000" step="100" />
            </label>

            <label>
              Maintenance cost growth (% p.a.)
              <input type="number" id="maintenanceGrowthPct" value="1.25" step="0.1" />
            </label>
          </fieldset>

          <!-- Financing -->
          <fieldset>
            <legend>Financing</legend>

            <label>
              Equity (€)
              <input type="number" id="equity" value="80000" step="1000" />
            </label>

            <label>
              Loan 1 term (years)
              <input type="number" id="loanTermYears1" value="30" step="1" />
            </label>

            <label>
              Fixed interest period (years)
              <input type="number" id="fixRateYears1" value="20" step="1" />
            </label>

            <label>
              Loan 1 interest rate (% p.a.)
              <input type="number" id="interestRate1Pct" value="3.5" step="0.1" />
            </label>

            <label>
              Disagio (%)
              <input type="number" id="discountRatePct" value="0" step="0.1" />
            </label>

            <label>
              Loan 2 term (years, refinancing)
              <input type="number" id="loanTermYears2" value="10" step="1" />
            </label>

            <label>
              Loan 2 interest rate (% p.a.)
              <input type="number" id="interestRate2Pct" value="4" step="0.1" />
            </label>
          </fieldset>

          <!-- Taxes & sale -->
          <fieldset>
            <legend>Taxes & Sale</legend>

            <label>
              Income tax rate (%)
              <input type="number" id="incomeTaxRatePct" value="30" step="1" />
            </label>

            <label>
              Alternative investment return before tax (% p.a.)
              <input type="number" id="altReturnBeforeTaxPct" value="6" step="0.1" />
            </label>

            <label>
              Tax on alternative investment (%)
              <input type="number" id="altTaxRatePct" value="26" step="1" />
            </label>

            <label>
              Selling costs (% of property value)
              <input type="number" id="sellingCostRatePct" value="3" step="0.1" />
            </label>

            <label>
              Investment horizon (years)
              <input type="number" id="investmentHorizonYears" value="30" step="1" />
            </label>

            <div class="radio-group">
              <span>Sale mode:</span>
              <label class="inline">
                <input type="radio" name="saleMode" value="hold" checked />
                Hold (no sale)
              </label>
              <label class="inline">
                <input type="radio" name="saleMode" value="sell" />
                Sell in year:
              </label>
              <input type="number" id="saleYear" value="15" step="1" class="sale-year-input" />
            </div>

            <label>
              AfA model
              <select id="afaModel">
                <option value="Linear 2%">Linear 2% p.a.</option>
                <option value="Linear 3%">Linear 3% p.a.</option>
                <option value="Degressive 5% + Linear 2%">Degressive 5% + Linear 2%</option>
                <option value="Degressive 5% + Linear 3%">Degressive 5% + Linear 3%</option>
                <option value="Linear 1/Restnutzungsdauer">Linear 1 / remaining life</option>
              </select>
            </label>

            <label>
              Remaining useful life for AfA (years, only used for "Linear 1 / remaining life")
              <input type="number" id="buildingLifetimeYears" value="50" step="1" />
            </label>
          </fieldset>

          <button type="button" id="runCalcBtn" class="btn-primary">
            Run calculation
          </button>
        </form>
      </section>

      <!-- MIDDLE/RIGHT: LOCATION PANEL -->
      <section class="panel panel-location">
        <h2>Location & socio context</h2>

        <label>
          Postal code (PLZ)
          <select id="plzSelect">
            <option value="">Select PLZ…</option>
          </select>
        </label>

        <button type="button" id="applySocioBtn" class="btn-secondary">
          Apply suggested rent & vacancy
        </button>

        <div id="plzSummary" class="plz-summary">
          <em>No PLZ selected yet.</em>
        </div>
      </section>

            <!-- RIGHT: RESULTS -->
      <section class="panel panel-results">
        <div class="results-header">
          <h2>Results</h2>
          <button type="button" id="printBtn" class="btn-secondary btn-print">
            Print / Save as PDF
          </button>
        </div>

        <div class="scenario-tabs">
          <button type="button" class="scenario-tab active" data-scenario="base">
            Base
          </button>
          <button type="button" class="scenario-tab" data-scenario="opt">
            Optimistic
          </button>
          <button type="button" class="scenario-tab" data-scenario="pes">
            Pessimistic
          </button>
        </div>

        <p class="scenario-caption">
          Active scenario:
          <strong id="activeScenarioLabel">Base</strong>
        </p>

        <div id="resultsKpis" class="results-kpis">
          <p>No calculation yet.</p>
        </div>

        <section class="panel-charts">
          <h3>Charts (active scenario)</h3>
          <div class="charts-grid">
            <div class="chart-card">
              <h4>Cashflow after tax per year</h4>
              <canvas id="cashflowChart"></canvas>
            </div>
            <div class="chart-card">
              <h4>Equity position over time</h4>
              <canvas id="equityChart"></canvas>
            </div>
            <div class="chart-card">
              <h4>Property value vs remaining debt</h4>
              <canvas id="propDebtChart"></canvas>
            </div>
          </div>
        </section>

        <details class="results-raw">
          <summary>Show raw result object (debug)</summary>
          <pre id="resultsRaw"></pre>
        </details>
      </section>
    </main>
  </div>

  <!-- Main application script (ES module) -->
  <script type="module" src="main.js"></script>
</body>
</html>
